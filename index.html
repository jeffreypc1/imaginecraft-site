<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImagineCraft Studios</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main class="explore-page" role="main">
        <div class="explore-container">
            <!-- Question and cursor area -->
            <div class="explore-question-area">
                <h1 class="explore-question" id="exploreQuestion">Why are you here?</h1>
                <!-- Cursor and thoughts inline together -->
                <div class="explore-cursor-line">
                    <div class="explore-thought-container" aria-live="polite" aria-atomic="true">
                        <button
                            class="explore-thought"
                            id="currentThought"
                            tabindex="0"
                            aria-label="Click to select this thought"
                        ></button>
                    </div><span class="explore-cursor" id="exploreCursor" aria-hidden="true">█</span>
                    <!-- Optional: text input appears here when user starts typing -->
                    <input
                        type="text"
                        class="explore-input"
                        id="exploreInput"
                        placeholder=""
                        aria-label="Type your own response"
                        autocomplete="off"
                    >
                </div>
            </div>

            <!-- Response panels (hidden by default) -->
            <div class="explore-panels" id="explorePanels" aria-live="polite">
                <!-- Panel 1: I have ideas -->
                <article class="explore-panel" data-thought="0" hidden>
                    <p class="panel-response" data-response="Starting is the hardest part. We will figure out the first step together."><span class="response-text"></span></p>
                    <div class="explore-panel-actions">
                        <button class="explore-reset" id="resetBtn0"><span class="action-text"></span></button>
                        <a href="main.html" class="explore-link" id="enterBtn0"><span class="action-text"></span></a>
                    </div>
                </article>

                <!-- Panel 2: I don't know where to start -->
                <article class="explore-panel" data-thought="1" hidden>
                    <p class="panel-response" data-response="Who we are is less important than what we can build together."><span class="response-text"></span></p>
                    <div class="explore-panel-actions">
                        <button class="explore-reset" id="resetBtn1"><span class="action-text"></span></button>
                        <a href="main.html" class="explore-link" id="enterBtn1"><span class="action-text"></span></a>
                    </div>
                </article>

                <!-- Panel 3: Our tools don't fit us -->
                <article class="explore-panel" data-thought="2" hidden>
                    <p class="panel-response" data-response="The right tools don't exist yet; we have to invent them."><span class="response-text"></span></p>
                    <div class="explore-panel-actions">
                        <button class="explore-reset" id="resetBtn2"><span class="action-text"></span></button>
                        <a href="main.html" class="explore-link" id="enterBtn2"><span class="action-text"></span></a>
                    </div>
                </article>

                <!-- Panel 4: I want software that matches how we work -->
                <article class="explore-panel" data-thought="3" hidden>
                    <p class="panel-response" data-response="Complexity is the enemy. We specialize in radical simplicity."><span class="response-text"></span></p>
                    <div class="explore-panel-actions">
                        <button class="explore-reset" id="resetBtn3"><span class="action-text"></span></button>
                        <a href="main.html" class="explore-link" id="enterBtn3"><span class="action-text"></span></a>
                    </div>
                </article>

                <!-- Panel 5: Help us think this through -->
                <article class="explore-panel" data-thought="4" hidden>
                    <p class="panel-response" data-response="Your vision is the blueprint. Our code is the foundation."><span class="response-text"></span></p>
                    <div class="explore-panel-actions">
                        <button class="explore-reset" id="resetBtn4"><span class="action-text"></span></button>
                        <a href="main.html" class="explore-link" id="enterBtn4"><span class="action-text"></span></a>
                    </div>
                </article>

                <!-- Panel 6: Who are you? -->
                <article class="explore-panel" data-thought="5" hidden>
                    <p class="panel-response" data-response="We're builders who believe software should feel inevitable."><span class="response-text"></span></p>
                    <div class="explore-panel-actions">
                        <button class="explore-reset" id="resetBtn5"><span class="action-text"></span></button>
                        <a href="main.html" class="explore-link" id="enterBtn5"><span class="action-text"></span></a>
                    </div>
                </article>

                <!-- Generic panel for typed input -->
                <article class="explore-panel" data-thought="custom" hidden>
                    <p class="panel-response" data-response="Every project starts with a conversation. Let's start ours."><span class="response-text"></span></p>
                    <div class="explore-panel-actions">
                        <button class="explore-reset" id="resetBtnCustom"><span class="action-text"></span></button>
                        <a href="main.html" class="explore-link" id="enterBtnCustom"><span class="action-text"></span></a>
                    </div>
                </article>
            </div>

            <!-- Critical Error Overlay for Easter Egg -->
            <div class="critical-error-overlay" id="criticalErrorOverlay" hidden>
                <p class="error-message" id="errorMessage"></p>
            </div>
        </div>
    </main>

    <!-- Contact Modal (reused from main site) -->
    <div class="modal-overlay" id="contactModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <button class="modal-close" onclick="closeContactModal()" aria-label="Close modal">&times;</button>
            <h2 id="modalTitle">Get in Touch</h2>
            <form class="modal-form" action="mailto:hello@imaginecraft.studio" method="GET" enctype="text/plain">
                <div class="form-group">
                    <label for="modalName">Name</label>
                    <input type="text" id="modalName" name="name" placeholder="Your name" required>
                </div>
                <div class="form-group">
                    <label for="modalEmail">Email</label>
                    <input type="email" id="modalEmail" name="email" placeholder="you@example.com" required>
                </div>
                <div class="form-group">
                    <label for="modalMessage">Message</label>
                    <textarea id="modalMessage" name="body" placeholder="Tell us about your project..." required></textarea>
                </div>
                <button type="submit" class="cta-button">Send Message</button>
            </form>
        </div>
    </div>

    <script>
        // ========================================
        // State Management
        // ========================================
        const thoughts = [
            "I have ideas.",
            "I don't know where to start.",
            "Our tools don't fit us.",
            "I want software that matches how we work.",
            "Help us think this through.",
            "Who are you?"
        ];

        let state = {
            currentIndex: 0,
            isUserTyping: false,
            isSelected: false,
            selectedIndex: null,
            cycleTimeout: null,
            animationTimeout: null,
            isAnimating: false,
            currentText: '',
            targetText: '',
            idleTimer: null,
            isInCrashSequence: false
        };

        // Timing configuration (in ms)
        const timing = {
            initialDelay: 3000,
            typeSpeedMin: 100,
            typeSpeedMax: 250,
            punctuationPause: 500,
            backspaceSpeedMin: 50,
            backspaceSpeedMax: 100,
            linger: 4000,
            idleTimeout: 120000 // 2 minutes
        };

        // Helper function for random delay between min and max
        function randomDelay(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Check if character is punctuation
        function isPunctuation(char) {
            return ['.', ',', '!', '?', ';', ':'].includes(char);
        }

        // Check for reduced motion preference
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        // ========================================
        // DOM Elements
        // ========================================
        const thoughtElement = document.getElementById('currentThought');
        const inputElement = document.getElementById('exploreInput');
        const panelsContainer = document.getElementById('explorePanels');
        const cursorElement = document.getElementById('exploreCursor');
        const errorOverlay = document.getElementById('criticalErrorOverlay');
        const errorMessage = document.getElementById('errorMessage');

        // ========================================
        // Idle Timer / Easter Egg
        // ========================================
        function resetIdleTimer() {
            if (state.isInCrashSequence) return;
            clearTimeout(state.idleTimer);
            state.idleTimer = setTimeout(triggerCriticalError, timing.idleTimeout);
        }

        function triggerCriticalError() {
            if (state.isInCrashSequence) return;
            state.isInCrashSequence = true;
            stopCycling();

            // Hide cursor
            cursorElement.classList.remove('visible');

            // Rapid flicker with red tint
            const explorePage = document.querySelector('.explore-page');
            let flickerCount = 0;
            const maxFlickers = 10;

            const flickerInterval = setInterval(() => {
                explorePage.classList.toggle('flicker-red');
                flickerCount++;
                if (flickerCount >= maxFlickers) {
                    clearInterval(flickerInterval);
                    explorePage.classList.remove('flicker-red');
                    showCriticalError();
                }
            }, 80);
        }

        function showCriticalError() {
            // Clear the screen
            const container = document.querySelector('.explore-container');
            container.classList.add('hidden');

            // Show error overlay
            errorOverlay.hidden = false;
            errorOverlay.classList.add('visible');
            errorMessage.textContent = '';

            // Type out error message with cursor
            const errorText = 'CRITICAL ERROR: SYSTEM DEPLETION. REBOOT RECOMMENDED.';
            typeErrorMessage(errorText, 0, () => {
                // Wait 10 seconds then reboot
                setTimeout(() => {
                    // Black screen
                    errorOverlay.classList.add('blackout');
                    errorMessage.textContent = '';

                    // After 2 seconds, reboot
                    setTimeout(() => {
                        rebootSystem();
                    }, 2000);
                }, 10000);
            });
        }

        function typeErrorMessage(text, index, callback) {
            if (index <= text.length) {
                errorMessage.innerHTML = text.substring(0, index) + '<span class="error-cursor">█</span>';

                const delay = prefersReducedMotion ? 0 : randomDelay(50, 100);
                setTimeout(() => {
                    typeErrorMessage(text, index + 1, callback);
                }, delay);
            } else {
                errorMessage.innerHTML = text + '<span class="error-cursor blink">█</span>';
                if (callback) callback();
            }
        }

        function rebootSystem() {
            // Hide error overlay
            errorOverlay.hidden = true;
            errorOverlay.classList.remove('visible', 'blackout');
            errorMessage.textContent = '';

            // Show container again
            const container = document.querySelector('.explore-container');
            container.classList.remove('hidden');

            // Full reset
            state.isInCrashSequence = false;
            resetExplore();
        }

        // Track user activity for idle timer
        ['click', 'mousemove', 'keydown', 'touchstart', 'scroll'].forEach(event => {
            document.addEventListener(event, resetIdleTimer, { passive: true });
        });

        // ========================================
        // Typing Animation
        // ========================================
        function typeCharacter(text, index, callback) {
            if (state.isUserTyping || state.isSelected) return;

            if (index <= text.length) {
                state.currentText = text.substring(0, index);
                thoughtElement.textContent = state.currentText;

                // Calculate delay - longer after punctuation, variable otherwise
                let delay = 0;
                if (!prefersReducedMotion) {
                    const lastChar = text.charAt(index - 1);
                    if (isPunctuation(lastChar)) {
                        delay = timing.punctuationPause;
                    } else {
                        delay = randomDelay(timing.typeSpeedMin, timing.typeSpeedMax);
                    }
                }

                state.animationTimeout = setTimeout(() => {
                    typeCharacter(text, index + 1, callback);
                }, delay);
            } else {
                if (callback) callback();
            }
        }

        function backspaceCharacter(callback) {
            if (state.isUserTyping || state.isSelected) return;

            if (state.currentText.length > 0) {
                state.currentText = state.currentText.substring(0, state.currentText.length - 1);
                thoughtElement.textContent = state.currentText;

                // Random jitter for backspace speed
                const delay = prefersReducedMotion ? 0 : randomDelay(timing.backspaceSpeedMin, timing.backspaceSpeedMax);

                state.animationTimeout = setTimeout(() => {
                    backspaceCharacter(callback);
                }, delay);
            } else {
                if (callback) callback();
            }
        }

        function showThought(index) {
            if (state.isUserTyping || state.isSelected || state.isAnimating) return;

            state.isAnimating = true;
            const thought = thoughts[index];
            state.targetText = thought;
            thoughtElement.dataset.index = index;

            // Make thought visible and start typing
            thoughtElement.classList.remove('fade-out');
            thoughtElement.classList.add('visible', 'fade-in');

            // Type out the thought character by character
            typeCharacter(thought, 0, () => {
                // Linger for 3 seconds after fully typed
                state.cycleTimeout = setTimeout(() => {
                    if (!state.isUserTyping && !state.isSelected) {
                        // Backspace the thought
                        backspaceCharacter(() => {
                            state.isAnimating = false;
                            // Move to next thought
                            state.currentIndex = (state.currentIndex + 1) % thoughts.length;
                            showThought(state.currentIndex);
                        });
                    }
                }, timing.linger);
            });
        }

        function startCycling() {
            // Show cursor after initial delay, then start cycling thoughts
            state.cycleTimeout = setTimeout(() => {
                cursorElement.classList.add('visible');
                showThought(state.currentIndex);
            }, timing.initialDelay);
        }

        function stopCycling() {
            clearTimeout(state.cycleTimeout);
            clearTimeout(state.animationTimeout);
            state.isAnimating = false;
        }

        // ========================================
        // Thought Selection
        // ========================================
        function selectThought(index) {
            state.isSelected = true;
            state.selectedIndex = index;
            stopCycling();

            // If we're selecting a cycling thought, show the full text
            if (typeof index === 'number' && thoughts[index]) {
                thoughtElement.textContent = thoughts[index];
                state.currentText = thoughts[index];
            }

            // Lock the thought in place
            thoughtElement.classList.add('selected');
            thoughtElement.classList.remove('fade-out', 'fade-in');
            thoughtElement.setAttribute('aria-pressed', 'true');

            // Hide cursor from thought line (it will appear in response)
            cursorElement.classList.remove('visible');

            // Show the corresponding panel
            showPanel(index);
        }

        function showPanel(index) {
            const panels = panelsContainer.querySelectorAll('.explore-panel');

            panels.forEach(panel => {
                if (panel.dataset.thought === String(index)) {
                    panel.hidden = false;
                    panel.classList.add('visible');

                    // Get panel elements
                    const responseEl = panel.querySelector('.panel-response');
                    const textEl = panel.querySelector('.response-text');
                    const actionsEl = panel.querySelector('.explore-panel-actions');
                    const resetBtn = panel.querySelector('.explore-reset');
                    const enterBtn = panel.querySelector('.explore-link');

                    if (responseEl && textEl) {
                        const fullResponse = responseEl.dataset.response;
                        textEl.textContent = '';

                        // Clear action texts
                        if (resetBtn) {
                            const resetText = resetBtn.querySelector('.action-text');
                            if (resetText) resetText.textContent = '';
                        }
                        if (enterBtn) {
                            const enterText = enterBtn.querySelector('.action-text');
                            if (enterText) enterText.textContent = '';
                        }

                        // Hide actions initially
                        if (actionsEl) actionsEl.classList.remove('visible');

                        // Start sequential typing: response -> actions
                        typePanelResponse(textEl, actionsEl, resetBtn, enterBtn, fullResponse, 0);
                    }

                    // Focus the panel for accessibility
                    setTimeout(() => {
                        const focusTarget = panel.querySelector('.panel-response') || panel.querySelector('h2');
                        if (focusTarget) focusTarget.focus();
                    }, 100);
                } else {
                    panel.hidden = true;
                    panel.classList.remove('visible');
                    // Clear any response text when hiding
                    const textEl = panel.querySelector('.response-text');
                    const actionsEl = panel.querySelector('.explore-panel-actions');
                    if (textEl) textEl.textContent = '';
                    if (actionsEl) actionsEl.classList.remove('visible');
                }
            });

            panelsContainer.classList.add('visible');
        }

        function typePanelResponse(textEl, actionsEl, resetBtn, enterBtn, text, index) {
            if (index <= text.length) {
                // Show cursor after text
                textEl.innerHTML = text.substring(0, index) + '<span class="typing-cursor">█</span>';

                let delay = 0;
                if (!prefersReducedMotion) {
                    const lastChar = text.charAt(index - 1);
                    if (isPunctuation(lastChar)) {
                        delay = timing.punctuationPause;
                    } else {
                        delay = randomDelay(timing.typeSpeedMin, timing.typeSpeedMax);
                    }
                }

                setTimeout(() => {
                    typePanelResponse(textEl, actionsEl, resetBtn, enterBtn, text, index + 1);
                }, delay);
            } else {
                // Response typing complete - remove cursor from response
                textEl.textContent = text;

                // Show actions container and start typing navigation
                if (actionsEl) {
                    actionsEl.classList.add('visible');
                    // Type out the navigation links
                    typeNavigationLinks(resetBtn, enterBtn);
                }
            }
        }

        function typeNavigationLinks(resetBtn, enterBtn) {
            const resetText = 'Change direction';
            const enterText = 'Enter Main Site';

            // Type "Change direction" first
            typeActionText(resetBtn, resetText, 0, () => {
                // Small pause then type "Enter Main Site"
                setTimeout(() => {
                    typeActionText(enterBtn, enterText, 0, () => {
                        // All done - make buttons functional
                        if (resetBtn) {
                            resetBtn.classList.add('ready');
                            resetBtn.onclick = resetExplore;
                        }
                        if (enterBtn) {
                            enterBtn.classList.add('ready');
                        }
                    });
                }, 300);
            });
        }

        function typeActionText(btn, text, index, callback) {
            if (!btn) {
                if (callback) callback();
                return;
            }

            const textSpan = btn.querySelector('.action-text');
            if (!textSpan) {
                if (callback) callback();
                return;
            }

            if (index <= text.length) {
                // Show cursor after text
                textSpan.innerHTML = text.substring(0, index) + '<span class="typing-cursor">█</span>';

                const delay = prefersReducedMotion ? 0 : randomDelay(60, 120);
                setTimeout(() => {
                    typeActionText(btn, text, index + 1, callback);
                }, delay);
            } else {
                // Typing complete - show final text without cursor
                textSpan.textContent = text;
                if (callback) callback();
            }
        }

        function resetExplore() {
            state.isSelected = false;
            state.isUserTyping = false;
            state.isAnimating = false;
            state.selectedIndex = null;
            state.currentIndex = 0;
            state.currentText = '';
            state.targetText = '';

            // Reset thought element
            thoughtElement.classList.remove('selected', 'visible', 'fade-in', 'fade-out');
            thoughtElement.textContent = '';
            thoughtElement.removeAttribute('aria-pressed');

            // Hide cursor initially (will be shown after delay when cycling restarts)
            cursorElement.classList.remove('visible');

            // Hide all panels and reset their elements
            const panels = panelsContainer.querySelectorAll('.explore-panel');
            panels.forEach(panel => {
                panel.hidden = true;
                panel.classList.remove('visible');
                // Reset panel elements
                const textEl = panel.querySelector('.response-text');
                const actionsEl = panel.querySelector('.explore-panel-actions');
                const resetBtn = panel.querySelector('.explore-reset');
                const enterBtn = panel.querySelector('.explore-link');

                if (textEl) textEl.textContent = '';
                if (actionsEl) actionsEl.classList.remove('visible');
                if (resetBtn) {
                    resetBtn.classList.remove('ready');
                    resetBtn.onclick = null;
                    const resetTextSpan = resetBtn.querySelector('.action-text');
                    if (resetTextSpan) resetTextSpan.textContent = '';
                }
                if (enterBtn) {
                    enterBtn.classList.remove('ready');
                    const enterTextSpan = enterBtn.querySelector('.action-text');
                    if (enterTextSpan) enterTextSpan.textContent = '';
                }
            });
            panelsContainer.classList.remove('visible');

            // Clear input
            inputElement.value = '';
            inputElement.classList.remove('active');

            // Restart cycling
            startCycling();

            // Reset idle timer
            resetIdleTimer();
        }

        // ========================================
        // Input Handling
        // ========================================
        function handleInputChange() {
            const hasValue = inputElement.value.trim().length > 0;

            if (hasValue && !state.isUserTyping) {
                state.isUserTyping = true;
                stopCycling();
                thoughtElement.classList.remove('visible', 'fade-in', 'fade-out');
                thoughtElement.textContent = '';
                state.currentText = '';
                inputElement.classList.add('active');
            } else if (!hasValue && state.isUserTyping) {
                state.isUserTyping = false;
                inputElement.classList.remove('active');
                if (!state.isSelected) {
                    startCycling();
                }
            }
        }

        function handleInputKeydown(event) {
            if (event.key === 'Enter' && inputElement.value.trim()) {
                event.preventDefault();
                selectThought('custom');
            }
        }

        // ========================================
        // Event Listeners
        // ========================================
        thoughtElement.addEventListener('click', () => {
            if (thoughtElement.classList.contains('visible') && !state.isSelected) {
                const index = parseInt(thoughtElement.dataset.index, 10);
                selectThought(index);
            }
        });

        thoughtElement.addEventListener('keydown', (event) => {
            if ((event.key === 'Enter' || event.key === ' ') &&
                thoughtElement.classList.contains('visible') &&
                !state.isSelected) {
                event.preventDefault();
                const index = parseInt(thoughtElement.dataset.index, 10);
                selectThought(index);
            }
        });

        inputElement.addEventListener('input', handleInputChange);
        inputElement.addEventListener('keydown', handleInputKeydown);

        // Focus input when clicking anywhere in question area
        document.querySelector('.explore-question-area').addEventListener('click', (event) => {
            if (!event.target.closest('.explore-thought') && !state.isSelected) {
                inputElement.focus();
            }
        });

        // ========================================
        // Contact Modal (reused)
        // ========================================
        function openContactModal() {
            document.getElementById('contactModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            document.getElementById('modalName').focus();
        }

        function closeContactModal() {
            document.getElementById('contactModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function closeModalOnOverlay(event) {
            if (event.target === event.currentTarget) {
                closeContactModal();
            }
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                closeContactModal();
            }
        });

        // ========================================
        // Initialize
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            // Apply reduced motion adjustments
            if (prefersReducedMotion) {
                timing.fadeIn = 0;
                timing.fadeOut = 0;
                timing.linger = 5000;
            }

            startCycling();
            resetIdleTimer();
        });
    </script>
</body>
</html>
